let baseAPIURL="http://lampstudio.local/api/",animePlayerUrl="http://lampstudio.local/anime/";window.MainComponent=function(){this.isLoadSerials=!1,this.serialsContainer=$("#anime-section"),this.serialsEmptyContainer=$("#serials-empty-container"),this.filterContainer=$("#filter-container"),this.page=1,this.filter={},this.init()},window.MainComponent.prototype={init:function(){$(this.filterContainer).find("select").on("change",$.proxy(this.onFilterChange,this))},loadSerials:function(){this.emptyResponse||(this.isLoadSerials=!0,console.log("Отправляем запрос, страничка "+this.page),$.ajax({type:"GET",url:baseAPIURL+"serial/",data:{page:1,filter:this.filter,sortField:"views|DESC"},success:function(i){0===i.data.length?MainComponentApp.serialsEmptyContainer.show():0<i.data.length&&(MainComponentApp.serialsEmptyContainer.hide(),i.data.forEach(function(i){i=MainComponentApp.prepareSerialNode(i);MainComponentApp.serialsContainer.append(i)})),MainComponentApp.isLoadSerials=!1},error:function(){$.toast({text:"Возникла ошибка при отправке запроса. \n Попробуйте позже",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"})}}))},onFilterChange:function(){this.filter={},this.serialsContainer.empty(),this.filterContainer.find("select").each(function(){var i,t;null!==$(this).val()&&(i=$(this).data("name"),"empty"!==(t=$(this).val())&&(MainComponentApp.filter[i]=t))}),this.loadSerials()},prepareSerialNode:function(i){var t=i.categories.join(", ");return'<div class="anime-list__block__section__item">\n                                <a href="'+animePlayerUrl+i.id+'">\n                                    <img src="'+i.posterURL+'" class="anime-list__block__section__item__image">\n                                </a>\n                                <div class="anime-list__block__section__item__detail">\n                                    <div class="anime-list__block__section__item__detail__header">\n                                        <h2><a href="'+animePlayerUrl+i.id+'">'+i.name+'</a>\n                                        </h2>\n                                        <h2>\n                                            <a href="'+animePlayerUrl+i.id+'">'+i.nameOrig+'</a>\n                                        </h2>\n                                    </div>\n                                    <div class="anime-list__block__section__item__detail__genre">\n                                        <h3>ЖАНРЫ:\n                                            '+t+'\n                                        </h3>\n                                    </div>\n                                    <div class="anime-list__block__section__item__detail__description">\n                                        <h3>'+i.shortDescription+"</h3>\n                                    </div>\n                                </div>\n                            </div>"}},window.PlayerComponent=function(i,t){this.initRating=i,this.serialId=t,this.ratingDom=$("#rating-wrap"),this.init()},window.PlayerComponent.prototype={init:function(){this.bindRating(),console.log(this.initRating)},bindRating:function(){this.ratingDom.children().on("click",function(){var i=$(this).data("rating");Player.setRating(i)}),this.ratingDom.children().on("mouseover",function(){var i=$(this).data("rating");Player.overRating(i)}),this.ratingDom.children().on("mouseout",function(){Player.outRating()})},setRating:function(i){$.ajax({type:"POST",url:baseAPIURL+"rating/",data:{serialId:this.serialId,rating:i},dataType:"json",success:function(i){$.toast({text:"Рейтинг успешно обновлен",bgColor:"#27ae60",textColor:"#ecf0f1",allowToastClose:!0,position:"bottom-right",icon:"success"})},error:function(){$.toast({text:"Возникла ошибка при добавлении рейтинга. \n Попробуйте позже",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"})}})},overRating:function(t){for(let i=1;i<11;i++)$("#rating-star-"+i).removeClass("full-star");for(let i=1;i<t;i++)$("#rating-star-"+i).addClass("full-star")},outRating:function(){for(let i=Math.round(this.initRating);i<11;i++)$("#rating-star-"+i).removeClass("full-star");for(let i=1;i<this.initRating+1;i++)$("#rating-star-"+i).addClass("full-star")}},window.SerialList=function(i=!1){this.isLoadSerials=!1,this.emptyResponse=!1,this.isOnGoingPage=i,console.log("Ongoing "+i),this.serialsContainer=$("#anime-section"),this.serialsEmptyContainer=$("#serials-empty-container"),this.selectSort=$("#sort"),this.filterContainer=$("#filter-container"),this.page=2,this.filter={},this.init()},window.SerialList.prototype={init:function(){$(window).on("scroll",$.proxy(this.onScroll,this)),this.selectSort.on("change",$.proxy(this.onSortChange,this)),$(this.filterContainer).find("select").on("change",$.proxy(this.onFilterChange,this))},onScroll:function(){window.scrollY+window.innerHeight>this.serialsContainer[0].getBoundingClientRect().bottom&&!this.isLoadSerials&&this.loadSerials()},loadSerials:function(){this.emptyResponse||(this.isOnGoingPage&&(console.log("OnGoing"),this.filter.status="Онгоинг"),this.isLoadSerials=!0,console.log("Отправляем запрос, страничка "+this.page),$.ajax({type:"GET",url:baseAPIURL+"serial/",data:{page:this.page++,sortField:this.selectSort.val(),filter:this.filter},success:function(i){0===i.data.length?(SerialsList.emptyResponse=!0,2===SerialsList.page&&SerialsList.serialsEmptyContainer.show()):0<i.data.length&&(SerialsList.serialsEmptyContainer.hide(),console.log("okay"),i.data.forEach(function(i){i=SerialsList.prepareSerialNode(i);SerialsList.serialsContainer.append(i)})),SerialsList.isLoadSerials=!1},error:function(){$.toast({text:"Возникла ошибка при отправке запроса. \n Попробуйте позже",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"})}}))},onSortChange:function(){this.page=1,this.emptyResponse=!1,this.serialsContainer.empty(),this.loadSerials()},onFilterChange:function(){this.filter={},this.page=1,this.emptyResponse=!1,this.serialsContainer.empty(),this.filterContainer.find("select").each(function(){var i,t;null!==$(this).val()&&(i=$(this).data("name"),"empty"!==(t=$(this).val())&&(SerialsList.filter[i]=t))}),this.loadSerials(),console.log(this.filter)},prepareSerialNode:function(i){var t=i.categories.join(", ");return'<div class="anime-item">\n                        <div class="anime-item__poster">\n                            <a href="'+animePlayerUrl+i.id+'"><img src="'+i.posterURL+'"></a>\n                            <div class="rate-flag">\n                                <div class="rate-flag__inner">\n                                    <div class="full-star blue-svg"></div>\n                                    <div class="rate-flag__text">'+i.averageRating+'</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="anime-item__detail">\n                            <h2 class="anime-item__header"><a href="'+animePlayerUrl+i.id+'">'+i.name+'</a></h2>\n                            <p><a href="'+animePlayerUrl+i.id+'">'+i.nameOrig+'</a></p>\n                            <div class="anime-item__info">\n                                <h2 class="anime-item__main-info">'+i.type+" / "+i.year+"\n                                    / "+t+'</h2>\n                            </div>\n                            <div class="anime-item__description">\n                                '+i.shortDescription+"\n                            </div>\n                        </div>\n                    </div>"}};