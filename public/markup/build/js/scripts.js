let baseAPIURL="http://lampstudio.local/api/",animePlayerUrl="http://lampstudio.local/anime/";window.MainComponent=function(){this.isLoadSerials=!1,this.serialsContainer=$("#anime-section"),this.serialsEmptyContainer=$("#serials-empty-container"),this.filterContainer=$("#filter-container"),this.page=1,this.filter={},this.init()},window.MainComponent.prototype={init:function(){$(this.filterContainer).find("select").on("change",$.proxy(this.onFilterChange,this))},loadSerials:function(){this.emptyResponse||(this.isLoadSerials=!0,console.log("Отправляем запрос, страничка "+this.page),$.ajax({type:"GET",url:baseAPIURL+"serial/",data:{page:1,filter:this.filter,sortField:"views|DESC"},success:function(t){0===t.data.length?MainComponentApp.serialsEmptyContainer.show():0<t.data.length&&(MainComponentApp.serialsEmptyContainer.hide(),t.data.forEach(function(t){t=MainComponentApp.prepareSerialNode(t);MainComponentApp.serialsContainer.append(t)})),MainComponentApp.isLoadSerials=!1},error:function(){$.toast({text:"Возникла ошибка при отправке запроса. \n Попробуйте позже",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"})}}))},onFilterChange:function(){this.filter={},this.serialsContainer.empty(),this.filterContainer.find("select").each(function(){var t,i;null!==$(this).val()&&(t=$(this).data("name"),"empty"!==(i=$(this).val())&&(MainComponentApp.filter[t]=i))}),this.loadSerials()},prepareSerialNode:function(t){var i=t.categories.join(", ");return'<div class="anime-list__block__section__item">\n                                <a href="'+animePlayerUrl+t.id+'">\n                                    <img src="'+t.posterURL+'" class="anime-list__block__section__item__image">\n                                </a>\n                                <div class="anime-list__block__section__item__detail">\n                                    <div class="anime-list__block__section__item__detail__header">\n                                        <h2><a href="'+animePlayerUrl+t.id+'">'+t.name+'</a>\n                                        </h2>\n                                        <h2>\n                                            <a href="'+animePlayerUrl+t.id+'">'+t.nameOrig+'</a>\n                                        </h2>\n                                    </div>\n                                    <div class="anime-list__block__section__item__detail__genre">\n                                        <h3>ЖАНРЫ:\n                                            '+i+'\n                                        </h3>\n                                    </div>\n                                    <div class="anime-list__block__section__item__detail__description">\n                                        <h3>'+t.shortDescription+"</h3>\n                                    </div>\n                                </div>\n                            </div>"}},window.modalAuth=function(){this.modalWindow=$("#modal-auth-container"),this.loginBtn=$("#login-btn"),this.authContainer=$("#modal-authorization"),this.loginAuthField=$("#login-auth"),this.passAuthField=$("#pass-auth"),this.authBtn=$("#auth-btn"),this.toRegBtn=$("#go-to-register-btn"),this.regContainer=$("#modal-registration"),this.loginRegField=$("#login-reg"),this.passRegField=$("#pass-reg"),this.repeatPassField=$("#repeat-pass-reg"),this.regBtn=$("#reg-btn"),this.toAuthBtn=$("#go-to-auth-btn"),this.init()},window.modalAuth.prototype={init:function(){this.loginBtn.on("click",function(){$.fancybox.open(ModalAuth.modalWindow,{touch:!1})}),this.toRegBtn.on("click",function(){ModalAuth.authContainer.hide(),ModalAuth.regContainer.css("display","flex")}),this.toAuthBtn.on("click",function(){ModalAuth.regContainer.hide(),ModalAuth.authContainer.css("display","flex")}),this.authBtn.on("click",$.proxy(this.authorize,this)),this.regBtn.on("click",$.proxy(this.register,this))},authorize:function(){var t=this.loginAuthField.val(),i=this.passAuthField.val();return""==t?($.toast({text:"Вы не заполнили имя пользователя",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"}),0):""==i?($.toast({text:"Вы не заполнили пароль",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"}),0):void $.ajax({type:"GET",url:baseAPIURL+"users/authorize",data:{username:t,password:i},dataType:"json",success:function(){location.reload()},error:function(t){console.error(t),$.toast({text:t.responseJSON.error,bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"})}})},register:function(){var t=this.loginRegField.val(),i=this.passRegField.val(),o=this.repeatPassField.val();return""===t?($.toast({text:"Вы не заполнили имя пользователя",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"}),0):""===i?($.toast({text:"Вы не заполнили пароль",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"}),0):o!==i?($.toast({text:"Введенные вами пароли не совпадают",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"}),0):void $.ajax({type:"POST",url:baseAPIURL+"users/registration",data:{username:t,password:i},dataType:"json",success:function(){location.reload()},error:function(t){console.error(t),$.toast({text:t.responseJSON.error,bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"})}})}},window.PlayerComponent=function(t,i){this.initRating=t,this.serialId=i,this.ratingDom=$("#rating-wrap"),this.init()},window.PlayerComponent.prototype={init:function(){this.bindRating(),console.log(this.initRating)},bindRating:function(){this.ratingDom.children().on("click",function(){var t=$(this).data("rating");Player.setRating(t)}),this.ratingDom.children().on("mouseover",function(){var t=$(this).data("rating");Player.overRating(t)}),this.ratingDom.children().on("mouseout",function(){Player.outRating()})},setRating:function(t){$.ajax({type:"POST",url:baseAPIURL+"rating/",data:{serialId:this.serialId,rating:t},dataType:"json",success:function(t){$.toast({text:"Рейтинг успешно обновлен",bgColor:"#27ae60",textColor:"#ecf0f1",allowToastClose:!0,position:"bottom-right",icon:"success"})},error:function(){$.toast({text:"Возникла ошибка при добавлении рейтинга. \n Попробуйте позже",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"})}})},overRating:function(i){for(let t=1;t<11;t++)$("#rating-star-"+t).removeClass("full-star");for(let t=1;t<i;t++)$("#rating-star-"+t).addClass("full-star")},outRating:function(){for(let t=Math.round(this.initRating);t<11;t++)$("#rating-star-"+t).removeClass("full-star");for(let t=1;t<this.initRating+1;t++)$("#rating-star-"+t).addClass("full-star")}},window.SerialList=function(t=!1){this.isLoadSerials=!1,this.emptyResponse=!1,this.isOnGoingPage=t,console.log("Ongoing "+t),this.serialsContainer=$("#anime-section"),this.serialsEmptyContainer=$("#serials-empty-container"),this.selectSort=$("#sort"),this.filterContainer=$("#filter-container"),this.page=2,this.filter={},this.init()},window.SerialList.prototype={init:function(){$(window).on("scroll",$.proxy(this.onScroll,this)),this.selectSort.on("change",$.proxy(this.onSortChange,this)),$(this.filterContainer).find("select").on("change",$.proxy(this.onFilterChange,this))},onScroll:function(){window.scrollY+window.innerHeight>this.serialsContainer[0].getBoundingClientRect().bottom&&!this.isLoadSerials&&this.loadSerials()},loadSerials:function(){this.emptyResponse||(this.isOnGoingPage&&(console.log("OnGoing"),this.filter.status="Онгоинг"),this.isLoadSerials=!0,console.log("Отправляем запрос, страничка "+this.page),$.ajax({type:"GET",url:baseAPIURL+"serial/",data:{page:this.page++,sortField:this.selectSort.val(),filter:this.filter},success:function(t){0===t.data.length?(SerialsList.emptyResponse=!0,2===SerialsList.page&&SerialsList.serialsEmptyContainer.show()):0<t.data.length&&(SerialsList.serialsEmptyContainer.hide(),console.log("okay"),t.data.forEach(function(t){t=SerialsList.prepareSerialNode(t);SerialsList.serialsContainer.append(t)})),SerialsList.isLoadSerials=!1},error:function(){$.toast({text:"Возникла ошибка при отправке запроса. \n Попробуйте позже",bgColor:"#c0392b",textColor:"#bdc3c7",allowToastClose:!0,position:"bottom-right",icon:"error"})}}))},onSortChange:function(){this.page=1,this.emptyResponse=!1,this.serialsContainer.empty(),this.loadSerials()},onFilterChange:function(){this.filter={},this.page=1,this.emptyResponse=!1,this.serialsContainer.empty(),this.filterContainer.find("select").each(function(){var t,i;null!==$(this).val()&&(t=$(this).data("name"),"empty"!==(i=$(this).val())&&(SerialsList.filter[t]=i))}),this.loadSerials(),console.log(this.filter)},prepareSerialNode:function(t){var i=t.categories.join(", ");return'<div class="anime-item">\n                        <div class="anime-item__poster">\n                            <a href="'+animePlayerUrl+t.id+'"><img src="'+t.posterURL+'"></a>\n                            <div class="rate-flag">\n                                <div class="rate-flag__inner">\n                                    <div class="full-star blue-svg"></div>\n                                    <div class="rate-flag__text">'+t.averageRating+'</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="anime-item__detail">\n                            <h2 class="anime-item__header"><a href="'+animePlayerUrl+t.id+'">'+t.name+'</a></h2>\n                            <p><a href="'+animePlayerUrl+t.id+'">'+t.nameOrig+'</a></p>\n                            <div class="anime-item__info">\n                                <h2 class="anime-item__main-info">'+t.type+" / "+t.year+"\n                                    / "+i+'</h2>\n                            </div>\n                            <div class="anime-item__description">\n                                '+t.shortDescription+"\n                            </div>\n                        </div>\n                    </div>"}};